class BasketApi{constructor(){this.url="/ajax/personal/basket.php",this.action={ADD:"ADD",SET_QUANTITY:"SET_QUANTITY",DELETE:"DELETE",GET_COUNT:"GET_COUNT",GET_AVAILABLE_OFFERS_FOR_PURCHASING:"GET_AVAILABLE_OFFERS_FOR_PURCHASING",GET_AVAILABLE_OFFERS_FOR_DELETING:"GET_AVAILABLE_OFFERS_FOR_DELETING"},this.headerTopBasketBadge=document.querySelector(".header__top-item .basket-badge"),this.headerBottomBasketBadge=document.querySelector(".header__bottom-item .basket-badge")}async getBasketCount(){var t={action:this.action.GET_COUNT};return Request.fetch(this.url,t)}async getAvailableOffersForPurchasing(t){t={action:this.action.GET_AVAILABLE_OFFERS_FOR_PURCHASING,id:t};return Request.fetch(this.url,t)}async getAvailableOffersForDeleting(t){t={action:this.action.GET_AVAILABLE_OFFERS_FOR_DELETING,id:t};return Request.fetch(this.url,t)}async addToBasket(t,e=1){t={action:this.action.ADD,id:t,quantity:e},e=await Request.fetch(this.url,t);return e&&this.displayBasketItemsCount(),e}async setProductQuantityToBasket(t,e){t={action:this.action.SET_QUANTITY,id:t,quantity:e},e=await Request.fetch(this.url,t);return"number"==typeof e&&this.displayBasketItemsCount(),e}async deleteFromBasket(t,e=1){t={action:this.action.DELETE,id:t,quantity:e},e=await Request.fetch(this.url,t);return e&&this.displayBasketItemsCount(),e}displayBasketItemsCount(){this.getBasketCount().then(t=>{t?(this.headerTopBasketBadge.textContent=t,this.headerTopBasketBadge.style.display="block",this.headerBottomBasketBadge.textContent=t,this.headerBottomBasketBadge.style.display="flex"):(this.headerTopBasketBadge.style.display="none",this.headerBottomBasketBadge.style.display="none")})}}
class CompareApi{constructor(){this.url="/ajax/personal/compare.php",this.action={ADD:"ADD_TO_COMPARE_LIST",DELETE:"DELETE_FROM_COMPARE_LIST"},this.headerTopCompareBadge=document.querySelector(".header__top-item .compare-badge"),this.headerBottomCompareBadge=document.querySelector(".header__bottom-item .compare-badge"),this.compareCount=window.compareCount||0}async addToCompare(e){e=await Request.fetch(`${this.url}?action=${this.action.ADD}&id=`+e);return e&&(this.compareCount++,this.displayCompareCount()),e}async deleteFromCompare(e){e=await Request.fetch(`${this.url}?action=${this.action.DELETE}&id=`+e);return e&&(this.compareCount--,this.displayCompareCount()),e}displayCompareCount(){this.compareCount?(this.headerTopCompareBadge.textContent=this.compareCount,this.headerTopCompareBadge.style.display="block",this.headerBottomCompareBadge.textContent=this.compareCount,this.headerBottomCompareBadge.style.display="flex"):(this.headerTopCompareBadge.style.display="none",this.headerBottomCompareBadge.style.display="none")}}
class FavoritesApi{constructor(){this.url="/ajax/personal/favorites.php",this.action={ADD:"ADD",DELETE:"DELETE"},this.cookieFavoritesName="favorites",this.cookieLongevityDays=365,this.headerTopFavoritesBadge=document.querySelector(".header__top-item .favorites-badge"),this.headerBottomFavoritesBadge=document.querySelector(".header__bottom-item .favorites-badge"),this.favoritesCount=window.favoritesCount||0,this.isAuth=window.isAuth}addProductToCookie(t){var e=Cookies.get(this.cookieFavoritesName);e?((e=JSON.parse(e)).push(t),Cookies.set(this.cookieFavoritesName,JSON.stringify(e),{expires:this.cookieLongevityDays})):Cookies.set(this.cookieFavoritesName,JSON.stringify([t]),{expires:this.cookieLongevityDays})}deleteProductFromCookie(e){var i=Cookies.get(this.cookieFavoritesName);if(i){let t=JSON.parse(i);t=t.filter(t=>t!==e),Cookies.set(this.cookieFavoritesName,JSON.stringify(t),{expires:this.cookieLongevityDays})}}async addToFavorites(t){var e;return this.isAuth?(e={action:this.action.ADD,id:t},(e=await Request.fetch(this.url,e))&&(this.favoritesCount++,this.displayFavoritesCount()),e):(this.addProductToCookie(t),this.favoritesCount++,this.displayFavoritesCount(),!0)}async deleteFromFavorites(t){var e;return this.isAuth?(e={action:this.action.DELETE,id:t},(e=await Request.fetch(this.url,e))&&(this.favoritesCount--,this.displayFavoritesCount()),e):(this.deleteProductFromCookie(t),this.favoritesCount--,this.displayFavoritesCount(),!0)}displayFavoritesCount(){this.favoritesCount?(this.headerTopFavoritesBadge.textContent=this.favoritesCount,this.headerTopFavoritesBadge.style.display="block",this.headerBottomFavoritesBadge.textContent=this.favoritesCount,this.headerBottomFavoritesBadge.style.display="flex"):(this.headerTopFavoritesBadge.style.display="none",this.headerBottomFavoritesBadge.style.display="none")}}
class Request{static async fetch(t,e=null){var a={method:"GET",headers:{"Content-Type":"application/json"}};return e&&(a.method="POST",a.body=JSON.stringify(e)),(await fetch(t,a)).json()}}
class BaseSlider{static breakpointMobile=580;constructor(e=".swiper",i={[BaseSlider.breakpointMobile]:{},default:{}}){this.swiperSelector=e,this.options=i}makeSlider(){return new Swiper(this.swiperSelector,{slidesPerView:1,spaceBetween:20,linesCount:2,multiLine:!1,navigation:{nextEl:".base-slider__next",prevEl:".base-slider__prev"},...this.options.default,breakpoints:{[BaseSlider.breakpointMobile]:{slidesPerView:2,...this.options[BaseSlider.breakpointMobile]}}})}}
class CatalogFilter{constructor(){this.productsDataBlock=document.querySelector(".products-data"),this.mainFiltersWrapper=document.querySelector(".category__filter-wrap"),this.mainFilters=this.mainFiltersWrapper.querySelector(".filters"),this.clearFilterButton=this.mainFilters.querySelector(".filters__clear"),this.filterSections=this.mainFilters.querySelectorAll(".filters-section"),this.filterCheckboxes=this.mainFilters.querySelectorAll('.filters-item input[type="checkbox"]'),this.mobileFilterOpenButton=document.querySelector(".filters-sort__btn"),this.mobileFilterCloseButton=document.querySelector(".filters__accept-btn"),this.loader=document.querySelector(".loading"),this.categoryHeaderContainer=document.querySelector(".category__header"),this.extraFilters=document.querySelector(".filters-sort"),this.availableCheckbox=this.extraFilters.querySelector("#available"),this.selectSortElement=this.extraFilters.querySelector("#select-sort"),this.selectCountElement=this.extraFilters.querySelector("#select-count"),this.listCountElements=this.extraFilters.querySelectorAll("#list-count li"),this.filterApplied=!0,this.createElements(),this.hangEvents()}hangEvents(){this.filterSections.forEach(e=>this.hangExpandSectionEvent(e)),this.filterCheckboxes.forEach(e=>this.hangChangeCheckboxEvent(e)),this.listCountElements.forEach(e=>this.hangChangeProductsCountEvent(e)),this.hangPaginationEvents(),this.hangAvailableEvent(),this.hangFiltersClearEvent(),this.hangFiltersExtraClearEvent(),this.hangOpenMobileFilterEvent(),this.hangOpenCloseFilterEvent(),this.setBadges(),this.hangProductCardsEvents()}hangOpenMobileFilterEvent(){this.mobileFilterOpenButton.addEventListener("click",()=>{this.mainFiltersWrapper.classList.add("category__filter-wrap--show")})}hangOpenCloseFilterEvent(){this.mobileFilterCloseButton.addEventListener("click",()=>{this.mainFiltersWrapper.classList.remove("category__filter-wrap--show")})}hangPaginationEvents(){this.paginationElements=document.querySelectorAll(".pagination div"),this.paginationElements.length&&this.paginationElements.forEach(i=>{i.addEventListener("click",()=>{var e=i.dataset.id,t=new URL(window.location.href);new URLSearchParams(t.search).get("PAGEN_1")!=e&&this.handleChangeFilters({PAGEN_1:e})})})}hangChangeProductsCountEvent(t){t.addEventListener("click",()=>{var e=t.dataset.id;this.selectorCount.getValue()!=e&&(this.changeProductsCountClasses(t),this.selectorCount.setValue(e),this.handleChangeFilters({itemsPerPage:e}))})}handleChangeFilters(e=null,t=!0){e=this.createNewUrl(e);this.changeScroll(),this.fetchProducts(e).then(e=>{e&&this.insertHtml(e)}),t&&this.changeUrl(e)}hangAvailableEvent(){this.availableCheckbox.addEventListener("change",()=>{var e=!!this.availableCheckbox.checked;this.handleChangeFilters({onlyAvailable:e})})}hangFiltersClearEvent(){this.clearFilterButton.addEventListener("click",()=>{this.filterApplied&&(this.resetControls(),this.handleChangeFilters())})}hangFiltersExtraClearEvent(){this.clearFilterExtraButton=document.querySelector(".products-not-found__button"),this.clearFilterExtraButton&&this.clearFilterExtraButton.addEventListener("click",e=>{e.preventDefault(),this.filterApplied&&(this.resetControls(),this.handleChangeFilters())})}hangChangeCheckboxEvent(i){i.addEventListener("change",()=>{var e=i.id,t=i.checked?"Y":"";this.handleChangeFilters({[e]:t}),this.setBadges()})}changeScroll(){1200<=window.innerWidth?this.categoryHeaderContainer.scrollIntoView(!1):document.body.scrollIntoView()}changeProductsCountClasses(e){this.extraFilters.querySelector("#list-count li.active").classList.remove("active"),e.classList.add("active")}insertHtml(e){e=(new DOMParser).parseFromString(e,"text/html").querySelector(".products-data");this.productsDataBlock.innerHTML=e.innerHTML,this.hangFiltersExtraClearEvent(),this.hangPaginationEvents(),this.hangProductCardsEvents()}resetControls(){this.availableCheckbox.checked=!1,this.filterCheckboxes.forEach(e=>e.checked=!1),this.selectorSort.resetValue(),this.selectorCount.resetValue(),this.inputMinPrice.clear(),this.inputMaxPrice.clear();var e=this.extraFilters.querySelector("#list-count li:first-of-type");this.changeProductsCountClasses(e),this.setBadges()}setLoader(e=!0){e?(this.mainFilters.style.pointerEvents="none",this.extraFilters.style.pointerEvents="none",this.loader.classList.add("loading--show"),this.productsDataBlock.classList.remove("products-data--show")):(this.mainFilters.style.pointerEvents="all",this.extraFilters.style.pointerEvents="all",this.loader.classList.remove("loading--show"),this.productsDataBlock.classList.add("products-data--show"))}changeUrl(e){var e=new URL(e),t=new URLSearchParams(e.search),t=(t.delete("minPrice"),t.delete("maxPrice"),t.toString());history.pushState(history.state,"",""+e.origin+e.pathname+(t?"?"+t:""))}createNewUrl(t=null){var e=new URL(window.location.href);const i=new URLSearchParams(e.search);if(i.set("minPrice",this.inputMinPrice.getValue()),i.set("maxPrice",this.inputMaxPrice.getValue()),!(this.filterApplied=!0)!==t){if(!t)return this.filterApplied=!1,""+e.origin+e.pathname;t.hasOwnProperty("PAGEN_1")||i.set("PAGEN_1","1"),Object.keys(t).forEach(e=>{t[e]?i.set(e,t[e]):i.delete(e)}),i.set("set_filter","Y")}return""+e.origin+e.pathname+"?"+i.toString()}async fetchProducts(e){try{return this.setLoader(!0),await(await fetch(e,{method:"GET",headers:{"Content-Type":"text/html","x-requested-with":"Y"}})).text()}finally{this.setLoader(!1)}}hangExpandSectionEvent(e){e.querySelector(".filters-section__header").addEventListener("click",()=>{e.classList.toggle("filters-section--expanded")})}createElements(){this.selectorSort=new Select({element:this.selectSortElement,onSelect:e=>{this.handleChangeFilters({sort:e})}}),this.selectorCount=new Select({element:this.selectCountElement,onSelect:e=>{var t=this.extraFilters.querySelector(`#list-count li[data-id="${e}"]`);this.changeProductsCountClasses(t),this.handleChangeFilters({itemsPerPage:e})}}),this.inputMinPrice=new Input({inputSelector:"#min-price",withDebounce:!0,onChange:()=>this.handleChangeFilters(!1,!1)}),this.inputMaxPrice=new Input({inputSelector:"#max-price",withDebounce:!0,onChange:()=>this.handleChangeFilters(!1,!1)})}setBadges(){this.filterSections.forEach(e=>{var t=e.querySelectorAll('input[type="checkbox"]');const i=e.querySelector(".filters-section__header h6"),s=i.querySelector(".filters-section__header-badge");Array.from(t).every(e=>{var t;return e.checked&&!s&&((t=document.createElement("div")).classList.add("filters-section__header-badge"),i.insertAdjacentElement("beforeend",t)),!e.checked})&&s&&s.remove()})}hangProductCardsEvents(){new ProductCards}}
class DropDownMenu{dropDown;dropdownItems;width=0;height=0;shift=0;constructor(e={element:element,sections:sections,level:level,minHeight:0}){this.element=e.element,this.sections=e.sections,this.level=e.level,this.minHeight=e.minHeight,this.render(),this.makeActionsAfterRender()}makeActionsAfterRender(){this.getNewElements(),this.calculateShift(),this.setExtraStyles(),this.hydrateDropDown(),this.hydrateElements()}getNewElements(){this.dropDown=this.element.querySelector(".nav-dropdown"),this.dropdownItems=this.dropDown.querySelectorAll(".header-nav-item")}hydrateDropDown(){var e=this.dropDown.querySelector("ul");new PerfectScrollbar(e)}hydrateElements(){this.dropdownItems.forEach(e=>{const t=e.dataset.id,i=this.sections[t].SUBSECTIONS;e.addEventListener("mouseenter",()=>{var e=this.dropDown.querySelector(".nav-dropdown__wrapper");e&&e.remove(),t&&i&&new DropDownMenu({element:this.dropDown,sections:i,level:this.level+1,minHeight:this.height})})})}render(){this.element.insertAdjacentHTML("beforeend",this.getHtml())}getHtml(){return`<div class="nav-dropdown__wrapper">
                <div class="nav-dropdown ${this.isOddLevel()&&" nav-dropdown--odd"}">
                    <ul>
                        ${this.getMenuItemsHtml()}
                    </ul>
                </div>
            </div>`}getMenuItemsHtml(){return Object.keys(this.sections).map(e=>{var{NAME:t,LINK:i}=this.sections[e];return`<li>
                    <div class="header-nav-item" data-id="${e}">
                        <a href="${i}">
                            <span>${t}</span>
                        </a>
                    </div>
                </li>`}).join("")}setExtraStyles(){var e=this.width/4>-this.shift,t={};this.minHeight&&(t.minHeight=this.minHeight+"px"),this.shift<0&&(t.transform="translateX(-200%)"),this.shift<0&&(this.level<=1||e)&&(t.transform=`translateX(${this.shift}px)`),this.dropDown.style.transform=t.transform,this.dropDown.style.minHeight=t.minHeight}calculateShift(){var e=this.dropDown.getBoundingClientRect(),e=(this.width=e.width,this.height=e.height,window.innerWidth-e.right);this.shift=e-window.catalogMenuContainer.right}isOddLevel(){return this.level%2!=0}}
window.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".footer-collapse").forEach(e=>{e.querySelector(".footer-collapse__toggle--mobile").addEventListener("click",()=>{e.classList.toggle("footer-collapse--expanded")})})});
window.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".header__spot"),o=t.querySelector(".header__spot-dropdown");var e=t.querySelector(".header__spot > span"),c=document.querySelectorAll(".catalog-category-mobile");const r=document.querySelector(".mobile-nav");var a=document.querySelector(".header__button-mobile"),n=document.querySelector(".mobile-nav__close");const s=document.querySelector(".header__contacts");var l=document.querySelector(".header__button-contacts"),d=document.querySelectorAll(".header .search-input");e.addEventListener("click",e=>{e.stopPropagation(),t.classList.toggle("header__spot--show")}),window.addEventListener("click",e=>{o.contains(e.target)||t.classList.remove("header__spot--show")}),c.forEach(e=>{e.querySelector(".catalog-category-mobile__title").addEventListener("click",()=>{e.classList.toggle("catalog-category-mobile--expanded")})}),a.addEventListener("click",()=>{r.classList.add("mobile-nav--show")}),n.addEventListener("click",()=>{r.classList.remove("mobile-nav--show"),s.classList.remove("header__contacts--show")}),l.addEventListener("click",()=>{s.classList.toggle("header__contacts--show")}),d.forEach(e=>{const t=e.querySelector("input");e=e.querySelector("button");t.addEventListener("keyup",e=>{13===e.keyCode&&(window.location.href="/search?q="+t.value)}),e.addEventListener("click",e=>{e.preventDefault(),window.location.href="/search?q="+t.value})})});

class MainSlider{swiper=null;delay=5e3;isHovered=!1;timerProgress=0;fps=30;timer=0;interval=null;perimeter=62.831853072;progressItems=[];wrapperDotItems=[];dotItems=[];circleItems=[];sliderProgressScroller=null;constructor(e=".swiper",s=[],t=!1){this.swiperSelector=e,this.sliderImages=s,this.compact=t}get getCurrentIndexSlider(){return this.swiper.realIndex??0}get countSlides(){return this.sliderImages.length}get timePerTick(){return 1e3/this.fps}getExtraElements(){this.progressItems=document.querySelectorAll(".main-slider-progress__item"),this.wrapperDotItems=document.querySelectorAll(".main-slider__dot"),this.dotItems=document.querySelectorAll(".main-slider-dot"),this.circleItems=document.querySelectorAll(".main-slider-dot svg circle:last-of-type"),this.sliderProgressScroller=document.querySelector(".main-slider-progress__scroller-inner")}makeSlider(){this.displayImages(),this.swiper=new Swiper(this.swiperSelector,{slidesPerView:1,direction:"vertical",height:this.compact?455:511,loop:!0,navigation:{nextEl:".main-slider__arrow-next",prevEl:".main-slider__arrow-prev"},on:{slideChangeTransitionEnd:()=>this.changeSlideTransitionEnd()},breakpoints:{580:{height:this.compact?482:964},992:{height:this.compact?318:635}}}),this.getExtraElements(),this.hangEvents(),this.startTimer()}hangEvents(){var e=document.querySelector(".main-slider");e.addEventListener("mouseenter",()=>{this.isHovered=!0,this.stopTimer()}),e.addEventListener("mouseleave",()=>{this.isHovered=!1,this.startTimer()}),this.progressItems.forEach((e,s)=>{e.addEventListener("click",()=>this.swiper.slideTo(s+1))}),this.wrapperDotItems.forEach((e,s)=>{e.addEventListener("click",()=>this.swiper.slideTo(s+1))})}displayImages(){var e=document.querySelectorAll(".main-slider .swiper-slide");992<window.innerWidth?e.forEach((e,s)=>e.style.backgroundImage=`url(${this.sliderImages[s].IMAGE})`):e.forEach((e,s)=>e.style.backgroundImage=`url(${this.sliderImages[s].IMAGE_MOBILE})`)}startTimer(){this.interval||(this.interval=setInterval(()=>this.tick(),1e3/this.fps))}stopTimer(){clearInterval(this.interval),this.interval=null}clearTimer(){this.timer=0}changeSlideTransitionEnd(){setTimeout(()=>{this.handleActiveClasses(),this.handleProgressScrollerPosition(),this.stopTimer(),this.clearTimer(),this.isHovered||this.startTimer()})}handleActiveClasses(){const t=this.getCurrentIndexSlider;this.progressItems.forEach((e,s)=>{s===t?e.classList.add("main-slider-progress__item--active"):e.classList.remove("main-slider-progress__item--active")}),this.dotItems.forEach((e,s)=>{s===t?e.classList.add("main-slider-dot_active"):e.classList.remove("main-slider-dot_active")})}handleProgressScrollerPosition(){var e,s,t;this.sliderProgressScroller&&(e=this.getCurrentIndexSlider,s=this.countSlides,this.sliderProgressScroller.style.left=(t=100/s)*e+"%",this.sliderProgressScroller.style.right=t*(s-e-1)+"%")}tick(){this.timer=this.timer+this.timePerTick,this.timerProgress=this.timer/this.delay,this.fillProgress(),this.timer>=this.delay&&(this.stopTimer(),this.clearTimer(),this.swiper.slideNext(300))}fillProgress(){var e;this.circleItems.length&&(e=this.getCurrentIndexSlider,this.circleItems[e].setAttribute("stroke-dasharray",this.perimeter*this.timerProgress+" "+(this.perimeter-this.perimeter*this.timerProgress)))}}
class Modal{constructor(e={modalOpenElementSelector:null,modalSelector:".modal",isCreateMode:!1,title:null}){this.isCreateMode=e.isCreateMode,this.isCreateMode?(this.modalTitle=e.title,this.modalElement=this.#createModal()):this.modalElement=document.querySelector(e.modalSelector),this.isOpen=!1,this.openModalElement=document.querySelector(e.modalOpenElementSelector),this.closeModalElement=this.modalElement.querySelector(".modal__close"),this.modalContentElement=this.modalElement.querySelector(".modal-content"),this.modalBodyElement=this.modalElement.querySelector(".modal-body"),this.#hangEvents()}#hangEvents(){this.openModalElement&&this.openModalElement.addEventListener("click",()=>this.open()),this.closeModalElement.addEventListener("click",()=>this.close()),window.addEventListener("click",e=>this.handleWindowClick(e))}#createModal(){var e=document.createElement("div");return e.id=this.createRandomId(),e.classList.add("modal"),e.insertAdjacentHTML("afterbegin",this.#createModalHtml()),document.body.appendChild(e),e}#createModalHtml(){return`<div class="modal-dialog">
                <div class="modal__close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                         class="bi bi-x" viewBox="0 0 16 16">
                        <path
                            d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                </div>
                <div class="modal-content">
                    <div class="modal-body">
                        ${this.modalTitle?`<h4 class="modal-title">${this.modalTitle}</h4>`:""}
                    </div>
                </div>
            </div>`}createRandomId(){let e="";for(;e.length<6;)e+=Math.random().toString(36).substring(2);return"modal-"+e.substring(0,6)}open(){this.createOverlay(),this.modalElement.classList.add("show"),this.isOpen=!0}close(){this.removeOverlay(),this.isOpen=!1,this.isCreateMode?this.modalElement.remove():this.modalElement.classList.remove("show"),this.onClose()}createOverlay(){var e=document.createElement("div");e.classList.add("modal-overlay"),document.body.appendChild(e)}removeOverlay(){var e=document.querySelector(".modal-overlay");e&&e.remove()}handleWindowClick(e){this.modalContentElement.contains(e.target)||this.openModalElement&&this.openModalElement.contains(e.target)||!this.isOpen||this.close()}setContent(e){this.modalBodyElement.insertAdjacentHTML("beforeend",e)}onClose(){}}
class ProductSubscribeModal extends Modal{constructor(t){super({isCreateMode:!0,title:"Сообщить о поступлении"}),this.productId=t,this.url="/ajax/form/productSubscribeForm.php",this.modalClass="subscribe-product-modal",this.createModal(),this.hangEvents(),super.open()}createModal(){var t=this.createModalHtml();this.setContent(t),this.createControls()}hangEvents(){this.modalForm=document.querySelector(`.${this.modalClass} form`),this.modalForm.addEventListener("submit",t=>this.handleSubmit(t))}async handleSubmit(t){if(t.preventDefault(),this.setDisableSubmitButton(!0),this.clearError(),this.isValidData())try{const e=await Request.fetch(this.url,this.getDataForSubmit());e.errors?Object.keys(e.errors).forEach(t=>{"message"===t?this.showError(e.errors[t]):this.inputs[t].setError(e.errors[t])}):(super.close(),new ProductSubscribeSuccessModal)}catch(t){this.showError("Ошибка запроса, попробуйте позже")}finally{this.setDisableSubmitButton(!1)}}setDisableSubmitButton(t){this.modalForm.querySelector('button[type="submit"]').disabled=t}showError(t){this.modalForm.querySelector('button[type="submit"]').insertAdjacentHTML("beforebegin",this.createErrorHtml(t))}clearError(){var t=this.modalForm.querySelector("#error-message");t&&t.remove()}createErrorHtml(t){return`<div id="error-message" class="alert alert-danger my-4" role="alert">${t}</div>`}isValidData(){let e=!1;return Object.keys(this.inputs).forEach(t=>{this.inputs[t].isValidValue()||(this.inputs[t].setError(),e=!0)}),!e}getDataForSubmit(){const e={};return Object.keys(this.inputs).forEach(t=>{e[t]=this.inputs[t].getValue()}),e}createControls(){this.inputName=new Input({wrapperSelector:`.${this.modalClass} .input--name`,required:!0,errorMessage:"Поле обязательно к заполнению"}),this.inputEmail=new Input({wrapperSelector:`.${this.modalClass} .input--email`,required:!0,validMask:/^([a-z0-9_\-\.]+)@([a-z0-9_\-\.]+)$/,errorMessage:"Введите email в корректном формате"}),this.inputPhone=new Input({wrapperSelector:`.${this.modalClass} .input--phone`,validMask:/^\+7\s\([0-9]{3}\)\s[0-9]{3}\-[0-9]{2}\-[0-9]{2}$/,mask:"+7 (###) ###-##-##",errorMessage:"Телефон должен быть в указанном формате"}),this.inputProductId=new Input({inputSelector:`.${this.modalClass} input[name="productId"]`}),this.inputs={name:this.inputName,email:this.inputEmail,phone:this.inputPhone,productId:this.inputProductId}}createModalHtml(){return`<div class="${this.modalClass}">
                <p>
                    Введите Ваши контактные данные, и мы уведомим Вас о поступлении данного
                    товара на склад.
                </p>
                <form>
                    <div class="input input--name my-4">
                        <label for="i_41" class="form-label">Имя</label>
                        <span class="input__container">
                            <input id="i_41" name="name" type="text" class="form-control"> 
                        </span>
                    </div>
                    <div class="input input--phone my-4">
                        <label for="i_42" class="form-label">Номер телефона</label>
                        <span class="input__container">
                            <input id="i_42" name="phone" type="text" placeholder="+7 (___)___-__-__" class="form-control">
                        </span>
                    </div>
                    <div class="input input--email my-4">
                        <label for="i_43" class="form-label">Email</label>
                        <span class="input__container">
                            <input id="i_43" name="email" type="text" placeholder="example@gmail.com" class="form-control">
                        </span>
                    </div>
                  
                    <input id="i_44" name="productId" value="${this.productId}" type="text" class="form-control" hidden>
            
                    <button type="submit" class="btn btn-primary w-100">Подтвердить</button>
                </form>
            </div>`}}
class ProductSubscribeSuccessModal extends Modal{constructor(){super({isCreateMode:!0,title:"Заявка отправлена"}),this.modalClass="subscribe-product-modal",this.createModal(),super.open()}createModal(){var t=this.createModalHtml();super.setContent(t),this.hangEvents()}hangEvents(){document.querySelector(`.${this.modalClass} button`).addEventListener("click",()=>super.close())}createModalHtml(){return`
            <div class="${this.modalClass}">
                <p>
                    Менеджер свяжется с вами в рабочее время и обсудит детали заказа.
                </p>
                <button class="btn btn-primary w-100">
                    Вернуться к покупкам
                </button>
            </div>    
        `}}
class SelectOfferModal extends Modal{static mode={ADD:"ADD",DELETE:"DELETE"};constructor(t={mode:SelectOfferModal.ADD,productId:0,onSubmit:t=>{}}){super({isCreateMode:!0,title:"Выбрать размер"}),this.selector=".modal-trade-offers",this.mode=t.mode,this.productId=t.productId,this.offers={},this.onSubmit=t.onSubmit,this.basketApi=new BasketApi,this.createModal()}createModal(){this.getData().then(t=>{t&&!Array.isArray(t)&&(this.offers=t,this.createElements(),this.hangSubmitEvent(),super.open())})}createElements(){var t=this.mapOffersForSelect(),t=this.createModalHtml(t);this.setContent(t),this.counter=new Counter({selectorMinusButton:this.selector+" .modal-trade-offers__minus",selectorPlusButton:this.selector+" .modal-trade-offers__plus",selectorInput:this.selector+" .modal-trade-offers__count input",minValue:1,maxValue:this.getFirstOffer().QUANTITY,initialValue:1}),this.select=new Select({selector:this.selector+" .select",onSelect:t=>this.handleChangeOffer(t)})}hangSubmitEvent(){this.submitButton=document.querySelector(this.selector+" .product-card__button"),this.submitButton.addEventListener("click",async()=>this.handleSubmit())}async handleSubmit(){var t=this.select.getValue(),e=this.counter.getValue();await this.postData(t,e)&&(super.close(),this.onSubmit(e))}postData(t,e){switch(this.mode){case SelectOfferModal.mode.ADD:return this.basketApi.addToBasket(t,e);case SelectOfferModal.mode.DELETE:return this.basketApi.deleteFromBasket(t,e);default:return this.basketApi.addToBasket(t,e)}}handleChangeOffer(t){this.counter.setMinValue(1),this.counter.setMaxValue(this.offers[t].QUANTITY),this.counter.setValue(1)}mapOffersForSelect(){return Object.keys(this.offers).map(t=>({id:this.offers[t].ID,title:this.offers[t].NAME}))}getFirstOffer(){for(var t in this.offers)return this.offers[t]}getData(){switch(this.mode){case SelectOfferModal.mode.ADD:return this.basketApi.getAvailableOffersForPurchasing(this.productId);case SelectOfferModal.mode.DELETE:return this.basketApi.getAvailableOffersForDeleting(this.productId);default:return this.basketApi.getAvailableOffersForPurchasing(this.productId)}}renderSelectOptions(t){return t.map(t=>`<div class="select__option" data-id="${t.id}" tabIndex="0">
                <span>${t.title}</span>
             </div>`)}createModalHtml(t){return`<div class="modal-trade-offers">
                <div class="modal-trade-offers__wr">
                     <div class="select__wrapper">
                        <div class="select">
                          <button class="select__main btn">
                            <div class="select__options">
                                ${this.renderSelectOptions(t).join("")}
                            </div>
                          </button>
                        </div>
                    </div>
                    
                    <span class="input-group modal-trade-offers__count">
                        <span class="modal-trade-offers__minus">-</span>
                        <input type="number" class="form-control"/>
                        <span class="modal-trade-offers__plus">+</span>
                    </span>
    
                    <button class="btn btn-primary product-card__button col-12" >
                        ${"DELETE"===this.mode?"Удалить из корзины":"В корзину"}
                    </button>
                </div>
            </div>`}}
class Counter{constructor(t={selectorMinusButton:"",selectorPlusButton:"",selectorInput:"",minValue:minValue,maxValue:maxValue,initialValue:0,blockChangeState:!1,disabledInput:!1,onChangeInput:(t,e)=>{},onPlus:(t,e)=>{},onMinus:(t,e)=>{}}){this.inputSelector=t.selectorInput,this.minusButton=document.querySelector(t.selectorMinusButton),this.plusButton=document.querySelector(t.selectorPlusButton),this.minValue=t.minValue||0,this.maxValue=t.maxValue||1e3,this.initialValue=t.initialValue,this.blockChangeState=t.blockChangeState,this.disabledInput=t.disabledInput,this.debounceTime=1500,this.onChangeInput=t.onChangeInput,this.onPlus=t.onPlus,this.onMinus=t.onMinus,this.hangEvents()}disableButtons(){this.minusButton.style.pointerEvents="none",this.plusButton.style.pointerEvents="none"}activateButtons(){this.minusButton.style.pointerEvents="all",this.plusButton.style.pointerEvents="all"}setMinValue(t){this.minValue=t}setMaxValue(t){this.maxValue=t}setValue(t){t<this.minValue?this.input.setValue(this.minValue):t>this.maxValue?this.input.setValue(this.maxValue):this.input.setValue(t)}getValue(){return this.input.getValue()}hangEvents(){this.input=new Input({inputSelector:this.inputSelector,initialValue:this.initialValue,disabled:this.disabledInput,onChange:t=>this.handleChangeInput(t)}),this.handleDecreaseCounter(),this.handleIncreaseCounter()}handleChangeInput(t){+t<this.minValue&&this.input.setValue(this.minValue),+t>this.maxValue&&this.input.setValue(this.maxValue),this.debouceTimeout&&clearTimeout(this.debouceTimeout),this.onChangeInput&&(this.debouceTimeout=setTimeout(()=>{this.onChangeInput(this.input.getValue(),this)},this.debounceTime))}handleIncreaseCounter(){this.plusButton.addEventListener("click",()=>{let t=this.input.getValue();t!=this.maxValue&&(this.blockChangeState||(t++,this.input.setValue(t)),this.onPlus)&&this.onPlus(+t,this)})}handleDecreaseCounter(){this.minusButton.addEventListener("click",()=>{let t=this.input.getValue();t!=this.minValue&&(this.blockChangeState||(t--,this.input.setValue(t)),this.onMinus)&&this.onMinus(+t,this)})}}
class Input{constructor(e={wrapperSelector:"",inputSelector:"",initialValue:"",debounceTime:2e3,withDebounce:!1,required:!1,validMask:null,mask:null,errorMessage:"Поле обязательно для заполнения",disabled:!1,onChange:e=>{},onClear:()=>{}}){this.inputWrapperSelector=e.wrapperSelector,this.inputWrapperElement=document.querySelector(this.inputWrapperSelector),this.inputSelector=e.inputSelector||this.inputWrapperSelector+" input",this.inputElement=document.querySelector(this.inputSelector),this.clearButtonElement=document.querySelector(this.inputSelector+" + .input__clear"),this.required=e.required,this.errorMessage=e.errorMessage,this.withDebounce=e.withDebounce,this.debouceTime=e.debounceTime||2e3,this.validMask=e.validMask,this.onChange=e.onChange,this.onClear=e.onClear,this.setMask(e.mask),this.setRequired(),this.setDisabled(e.disabled),this.setInitialValue(e.initialValue),this.hangEvents()}hangEvents(){this.handleChange(),this.handleClear(),this.handleFocus(),this.handleBlur()}setMask(e){e&&new Inputmask(e).mask(this.inputSelector)}setRequired(){this.required&&this.inputWrapperElement&&this.inputWrapperElement.classList.add("input--required")}getValue(){return this.inputElement.value}setDisabled(e){this.inputElement.disabled=e}setInitialValue(e){e&&this.setValue(e)}setValue(e){this.inputElement.value=e}clear(){this.clearButtonElement&&this.clearButtonElement.classList.remove("show"),this.inputElement.value="",this.onClear&&this.onClear()}handleChange(){this.inputElement.addEventListener("input",()=>{if(this.toggleClearButton(),this.debouceTimeout&&clearTimeout(this.debouceTimeout),this.onChange){const e=this.getValue();this.withDebounce?this.debouceTimeout=setTimeout(()=>{this.onChange(e,this)},this.debouceTime):this.onChange(e)}})}handleFocus(){this.inputElement.addEventListener("focus",()=>{this.clearError()})}handleBlur(){this.inputElement.addEventListener("blur",()=>{this.isValidValue()||this.setError()})}handleClear(){this.clearButtonElement&&this.clearButtonElement.addEventListener("click",()=>this.clear())}setError(e){var t;this.inputWrapperElement&&this.inputWrapperElement.classList.add("is-invalid"),this.inputElement.classList.add("is-invalid"),document.querySelector(this.inputWrapperSelector+" .invalid-feedback")||((t=document.createElement("div")).classList.add("invalid-feedback"),t.textContent=e||this.errorMessage,this.inputElement.insertAdjacentElement("afterend",t))}clearError(){this.inputElement.classList.remove("is-invalid"),this.inputWrapperElement&&this.inputWrapperElement.classList.remove("is-invalid");var e=document.querySelector(this.inputWrapperSelector+" .invalid-feedback");e&&e.remove()}isValidValue(){var e=this.getValue();return!(this.required&&!e||e&&this.validMask&&!this.validMask.test(e))}toggleClearButton(){this.clearButtonElement&&(this.getValue()?this.clearButtonElement.classList.add("show"):this.clearButtonElement.classList.remove("show"))}}
class Select{constructor(t={selector:".select",element:null,onSelect:t=>{}}){t.element?this.select=t.element:this.select=document.querySelector(t.selector),this.selectButton=this.select.querySelector(".select__main"),this.options=this.select.querySelectorAll(".select__option"),this.placeholder=this.select.dataset.placeholder,this.initialValueId=this.select.dataset.initialId,this.isOpen=!1,this.value={},this.onSelect=t.onSelect,this.setInitialValue(),this.hangEvents()}hangEvents(){this.selectButton.addEventListener("click",()=>this.open()),this.options.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation(),this.selectOption(e)})}),window.addEventListener("click",t=>this.handleWindowClick(t))}handleWindowClick(t){!this.select.contains(t.target)&&this.isOpen&&this.close()}resetValue(){this.placeholder?(this.setValueTextInHtml(this.placeholder),this.value={}):this.setValue(this.initialValueId)}setInitialValue(){var t,e;0!==this.options.length&&(this.initialValueId?this.options.forEach(t=>{var e=t.dataset.id;e===this.initialValueId&&(t=t.querySelector("span").textContent.trim(),this.setValue(e,t))}):this.placeholder?this.setValueTextInHtml(this.placeholder):this.initialValueId||(t=this.options[0].dataset.id,e=this.options[0].querySelector("span").textContent.trim(),this.setValue(t,e),this.initialValueId=this.value.id))}getValue(){return this.value.id}setValue(t,e=null){let s=e;s||(e=this.select.querySelector(`.select__option[data-id="${t}"]`),s=e.textContent.trim()),this.value={id:t,title:s},this.setValueTextInHtml(this.value.title)}setValueTextInHtml(t){this.selectButton.childNodes[0].nodeValue=t}selectOption(t){var e=t.dataset.id;e!=this.value.id&&(t=t.querySelector("span").textContent.trim(),this.setValue(e,t),this.onSelect)&&this.onSelect(e),this.close()}open(){this.isOpen=!0,this.select.classList.add("select--expanded")}close(){this.isOpen=!1,this.select.classList.remove("select--expanded")}}
class Tooltip{constructor(t,e){this.wrapper=t,this.tooltip=e,this.createTooltip(),this.hangEvents()}createTooltip(){this.popper=Popper.createPopper(this.wrapper,this.tooltip,{placement:"right",modifiers:[{name:"offset",options:{offset:[0,8]}}]})}hangEvents(){this.wrapper.addEventListener("mouseenter",()=>{this.tooltip.setAttribute("data-show",""),this.popper.update()}),this.wrapper.addEventListener("mouseleave",()=>{this.tooltip.removeAttribute("data-show")})}}
class ProductCardBasket{constructor(t){this.productElement=t,this.productId=this.productElement.dataset.id,this.productQuantity=this.productElement.dataset.productQuantity,this.offersQuantity=this.productElement.dataset.offersQuantity,this.basketApi=new BasketApi,this.hangEvents()}hangEvents(){var t=this.productElement.querySelector(".product-card__availability");t?t.addEventListener("click",t=>{t.stopPropagation(),new ProductSubscribeModal(this.productId)}):(this.hangCounterEvents(),this.hangAddToBasketButtonEvents())}hangAddToBasketButtonEvents(){const t=this.productElement.querySelector(".product-card__add-basket");t&&t.addEventListener("click",()=>{0<this.offersQuantity?this.handleAddFirstOfferToBasket():this.handleAddFirstProductToBasket(t)})}hangCounterEvents(){this.productElement.querySelector(".product__add-count")&&(0<this.offersQuantity?this.createCounterInstanceForOffers():this.createCounterInstanceForProducts())}createCounterInstanceForProducts(){var t=`.product-card[data-id="${this.productId}"]`;new Counter({selectorMinusButton:t+" .product__add-minus",selectorPlusButton:t+" .product__add-plus",selectorInput:t+" .product__add-count input",maxValue:this.productQuantity,blockChangeState:!0,onPlus:(t,e)=>{this.handleAddProductToBasket(e)},onMinus:(t,e)=>{this.handleDeleteProductFromBasket(e)},onChangeInput:(t,e)=>{this.handleSetQuantityForProduct(t,e)}})}createCounterInstanceForOffers(){var t=`.product-card[data-id="${this.productId}"]`;new Counter({selectorMinusButton:t+" .product__add-minus",selectorPlusButton:t+" .product__add-plus",selectorInput:t+" .product__add-count input",blockChangeState:!0,disabledInput:!0,onPlus:(t,e)=>{this.handleAddOfferToBasket(e)},onMinus:(t,e)=>{this.handleDeleteOfferFromBasket(e)}})}handleAddFirstOfferToBasket(){new SelectOfferModal({mode:SelectOfferModal.mode.ADD,productId:this.productId,onSubmit:t=>{this.createCounter(t)}})}handleAddFirstProductToBasket(e){e.style.pointerEvents="none",this.basketApi.addToBasket(this.productId).then(t=>{t?(this.createCounter(),this.productElement.dataset.productBasket=1):e.style.pointerEvents="all"}).catch(()=>e.style.pointerEvents="all")}handleAddProductToBasket(e){this.productQuantity!=e.getValue()&&(e.disableButtons(),this.basketApi.addToBasket(this.productId).then(t=>{t?(t=+e.getValue()+1,e.setValue(t),this.productElement.dataset.productBasket=t):e.activateButtons()}).finally(()=>e.activateButtons()))}handleDeleteProductFromBasket(e){e.disableButtons(),this.basketApi.deleteFromBasket(this.productId).then(t=>{t?0==(t=e.getValue()-1)?this.createAddToBasketButton():(e.setValue(t),e.activateButtons(),this.productElement.dataset.productBasket=t):e.activateButtons()}).catch(()=>e.activateButtons())}handleSetQuantityForProduct(t,e){e.disableButtons();const a=this.productElement.dataset.productBasket;this.basketApi.setProductQuantityToBasket(this.productId,t).then(t=>{0===t?this.createAddToBasketButton():e.setValue(t),this.productElement.dataset.productBasket=t}).catch(()=>e.setValue(a)).finally(()=>e.activateButtons())}handleAddOfferToBasket(a){this.offersQuantity!=a.getValue()&&new SelectOfferModal({mode:SelectOfferModal.mode.ADD,productId:this.productId,onSubmit:t=>{var e=a.getValue();a.setValue(+e+ +t)}})}handleDeleteOfferFromBasket(a){new SelectOfferModal({mode:SelectOfferModal.mode.DELETE,productId:this.productId,onSubmit:t=>{var e=a.getValue();+e==+t?this.createAddToBasketButton():a.setValue(e-t)}})}createAddToBasketButton(){this.productElement.querySelector(".product-card__add--main").innerHTML=this.getAddToBasketButtonHtml(),this.hangAddToBasketButtonEvents()}createCounter(t=1){this.productElement.querySelector(".product-card__add--main").innerHTML=this.createCounterHtml(t),this.hangCounterEvents()}getAddToBasketButtonHtml(){return`<button class="btn btn-primary product-card__button product-card__add-basket">
                 В корзину
             </button>`}createCounterHtml(t=1){return`<span class="input-group product__add-count">
                <span class="btn btn-primary product__add-minus">-</span>
                <input type="number" class="form-control" value="${t}" />
                <span class="btn btn-primary product__add-plus">+</span>
             </span>`}}
class ProductCardCompare{constructor(e){this.productElement=e,this.compareApi=new CompareApi,this.hangEvents()}hangEvents(){const e=this.productElement.dataset.id,t=this.productElement.querySelector(".product-card__compare--default"),a=this.productElement.querySelector(".product-card__compare--active");t.addEventListener("click",async()=>this.addCompare(t,a,e)),a.addEventListener("click",async()=>this.deleteCompare(t,a,e))}async addCompare(e,t,a){await this.compareApi.addToCompare(a)&&(e.style.display="none",t.style.display="inline")}async deleteCompare(e,t,a){await this.compareApi.deleteFromCompare(a)&&(t.style.display="none",e.style.display="inline")}}
class ProductCardFavorites{constructor(t){this.productElement=t,this.favoritesApi=new FavoritesApi,this.hangEvents()}hangEvents(){const t=this.productElement.dataset.id,e=this.productElement.querySelector(".product-card__fav--default"),s=this.productElement.querySelector(".product-card__fav--active");e.addEventListener("click",async()=>this.addFavorites(e,s,t)),s.addEventListener("click",async()=>this.deleteFavorites(e,s,t))}async addFavorites(t,e,s){await this.favoritesApi.addToFavorites(s)&&(t.style.display="none",e.style.display="inline")}async deleteFavorites(t,e,s){await this.favoritesApi.deleteFromFavorites(s)&&(e.style.display="none",t.style.display="inline")}}
class ProductCards{constructor(){this.productElements=document.querySelectorAll(".product-card"),this.hangEvents()}hangEvents(){this.productElements.forEach(r=>{new ProductCardFavorites(r),new ProductCardCompare(r),new ProductCardBasket(r),r.querySelectorAll(".product-card__tags .info").forEach(r=>{var t=r.querySelector("span:first-child"),r=r.querySelector(".tooltip");new Tooltip(t,r)})})}}